import streamlit as st
import subprocess
import sys

# -------------------------------------------------
# 1. роирпВро▓роХ роЗро▒роХрпНроХрпБроородро┐ рооро▒рпНро▒рпБроорпН роЕроорпИрокрпНрокрпБ
# -------------------------------------------------
try:
    import tamilrulepy
    from tamilrulepy import vidhikal
    from tamilrulepy.meymayakkam import meymayakkam_rules # роПро▒рпНроХройро╡рпЗ роЙро│рпНро│ ро╡ро┐родро┐роХро│рпН
    status = True
except Exception as e:
    status = False
    error_msg = str(e)

# -------------------------------------------------
# 2. рокроХрпНроХ ро╡роЯро┐ро╡роорпИрокрпНрокрпБ
# -------------------------------------------------
st.set_page_config(page_title="Tolkapy - родрпКро▓рпНроХро╛рокрпНрокро┐роп роЖропрпНро╡рпБ", layout="wide")

st.title("ЁЯУЬ Tolkapy (родрпКро▓рпНроХро╛рокрпНрокро┐)")
st.subheader("родрпКро▓рпНроХро╛рокрпНрокро┐роп роЗро▓роХрпНроХрог ро╡ро┐родро┐роХро│рпН роЖропрпНро╡рпБроЪрпН роЪрпЖропро▓ро┐")

if not status:
    st.error(f"тЭМ роирпВро▓роХродрпНродрпИ роПро▒рпНро▒ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: {error_msg}")
    st.stop()

# -------------------------------------------------
# 3. роорпБродройрпНроорпИроЪрпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН (Tabs)
# -------------------------------------------------
tab1, tab2, tab3, tab4 = st.tabs(["роорпЖропрпНроорпНрооропроХрпНроХроорпН", "роорпКро┤ро┐роорпБродро▓рпН", "роорпКро┤ро┐ропро┐ро▒рпБродро┐", "рокрпБрогро░рпНроЪрпНроЪро┐"])

# --- TAB 1: роорпЖропрпНроорпНрооропроХрпНроХроорпН ---
with tab1:
    st.header("роорпЖропрпНроорпНрооропроХрпНроХроорпН роЖропрпНро╡рпБ")
    word_m = st.text_input("роЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН (роорпЖропрпНроорпНрооропроХрпНроХроорпН):", placeholder="роО.роХро╛: родроЩрпНроХроорпН", key="m1")
    if st.button("роЖро░ро╛ропрпНроХ", key="b1"):
        res = vidhikal.meymayakkam_checker(word_m)
        if res == True:
            st.success(f"тЬЕ '{word_m}' - роорпЖропрпНроорпНрооропроХрпНроХ ро╡ро┐родро┐роХро│ро┐ройрпНрокроЯро┐ роЪро░ро┐ропро╛рой роЪрпКро▓рпН.")
        else:
            st.warning(f"тЪая╕П роЖропрпНро╡рпБ роорпБроЯро┐ро╡рпБ: {res}")

# --- TAB 2: роорпКро┤ро┐роорпБродро▓рпН ---
with tab2:
    st.header("роорпКро┤ро┐роорпБродро▓рпН роОро┤рпБродрпНродрпБроХрпНроХро│рпН роЖропрпНро╡рпБ")
    st.info("роЪрпКро▓рпНро▓ро┐ройрпН роорпБродро▓рпН роОро┤рпБродрпНродрпБ родрпКро▓рпНроХро╛рокрпНрокро┐роп ро╡ро┐родро┐рокрпНрокроЯро┐ роЕроорпИропрпБрооро╛ роОрой роЖро░ро╛ропрпНроХро┐ро▒родрпБ.")
    word_f = st.text_input("роЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН (роорпКро┤ро┐роорпБродро▓рпН):", placeholder="роО.роХро╛: родрооро┐ро┤рпН", key="f1")
    if st.button("роЪро░ро┐рокро╛ро░рпН", key="b2"):
        # роирпВро▓роХродрпНродро┐ро▓рпН роЙро│рпНро│ роорпКро┤ро┐роорпБродро▓рпН ро╡ро┐родро┐ропрпИ роЕро┤рпИродрпНродро▓рпН
        if hasattr(vidhikal, 'mozhi_muthal_checker'):
            res = vidhikal.mozhi_muthal_checker(word_f)
            st.write(f"роЖропрпНро╡рпБ роорпБроЯро┐ро╡рпБ: {res}")
        else:
            st.info("роорпКро┤ро┐роорпБродро▓рпН ро╡ро┐родро┐роХро│рпБроХрпНроХро╛рой родро░ро╡рпБроХро│рпН роЪрпЗроХро░ро┐роХрпНроХрокрпНрокроЯрпБроХро┐ройрпНро▒рой.")

# --- TAB 3: роорпКро┤ро┐ропро┐ро▒рпБродро┐ ---
with tab3:
    st.header("роорпКро┤ро┐ропро┐ро▒рпБродро┐ роОро┤рпБродрпНродрпБроХрпНроХро│рпН роЖропрпНро╡рпБ")
    word_e = st.text_input("роЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН (роорпКро┤ро┐ропро┐ро▒рпБродро┐):", placeholder="роО.роХро╛: роиро┐ро▓ройрпН", key="e1")
    if st.button("роЪро░ро┐рокро╛ро░рпН", key="b3"):
        if hasattr(vidhikal, 'mozhi_iruthi_checker'):
            res = vidhikal.mozhi_iruthi_checker(word_e)
            st.write(f"роЖропрпНро╡рпБ роорпБроЯро┐ро╡рпБ: {res}")
        else:
            st.info("роорпКро┤ро┐ропро┐ро▒рпБродро┐ ро╡ро┐родро┐роХро│рпБроХрпНроХро╛рой родро░ро╡рпБроХро│рпН роЖропрпНро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ройрпНро▒рой.")

# --- TAB 4: рокрпБрогро░рпНроЪрпНроЪро┐ ---
with tab4:
    st.header("рокрпБрогро░рпНроЪрпНроЪро┐ роЖропрпНро╡рпБ (Sandhi)")
    col1, col2 = st.columns(2)
    with col1:
        w1 = st.text_input("роиро┐ро▓рпИроорпКро┤ро┐:", placeholder="роО.роХро╛: рооро░роорпН")
    with col2:
        w2 = st.text_input("ро╡ро░рпБроорпКро┤ро┐:", placeholder="роО.роХро╛: роХро┐ро│рпИ")
    
    if st.button("рокрпБрогро░рпНроХрпНроХ", key="b4"):
        if w1 and w2:
            # роирпВро▓роХродрпНродро┐ро▓рпН роЙро│рпНро│ рокрпБрогро░рпНроЪрпНроЪро┐ ро╡ро┐родро┐ропрпИ роЕро┤рпИродрпНродро▓рпН
            # роХрпБро▒ро┐рокрпНрокрпБ: роирпВро▓роХродрпНродро┐ройрпН родро▒рпНрокрпЛродрпИроп роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпИрокрпН рокрпКро▒рпБродрпНродрпБ роЗродрпБ рооро╛ро▒рпБрокроЯрпБроорпН
            try:
                # роТро░рпБ роОро│ро┐роп рооро╛родро┐ро░ро┐рокрпН рокрпБрогро░рпНроЪрпНроЪро┐ роЪрпЛродройрпИ (роирпВро▓роХ ро╡ро┐родро┐роХро│ро┐ройрпНрокроЯро┐)
                combined = f"{w1} + {w2}" 
                st.code(f"рокрпБрогро░рпНроЪрпНроЪро┐ роорпБроЯро┐ро╡рпБ: {combined}")
                st.write("рокрпБрогро░рпНроЪрпНроЪро┐ ро╡ро┐родро┐роХро│рпН роХрпБро▒ро┐родрпНрод ро╡ро┐ро░ро┐ро╡ро╛рой родроХро╡ро▓рпНроХро│рпН ро╡ро┐ро░рпИро╡ро┐ро▓рпН роЗрогрпИроХрпНроХрокрпНрокроЯрпБроорпН.")
            except Exception as e:
                st.error(f"рокро┐ро┤рпИ: {e}")

st.divider()
st.caption("роЙро░рпБро╡ро╛роХрпНроХроорпН: роорпБройрпИро╡ро░рпН роЪродрпНродро┐ропро░ро╛роЪрпБ родроЩрпНроХроЪрпНроЪро╛рооро┐, рокрпВрокро╛ро▓ройрпН, роХрогро┐ропроорпН роЕро▒роХрпНроХроЯрпНроЯро│рпИ & родрооро┐ро┤рпНро░рпВро▓рпНрокрпИ (tamilrulepy) роХрпБро┤рпБро╡ро┐ройро░рпН")
